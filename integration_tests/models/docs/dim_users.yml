version: 2

models:
  - name: dim_users
    description: >
      A model built off the `users` seed, with many versions of the hash and
      redact macros implemented for comparison
    docs:
      show: false
    tests:
      - dbt_utils.expression_is_true:
          expression: email_hash != email_hash_512
      - dbt_utils.expression_is_true:
          expression: email_hash != email_hash_name_salt
      - dbt_utils.expression_is_true:
          expression: email_hash = unique_email_hash
      - dbt_utils.expression_is_true:
          expression: email_hash != email_hash_default_salt
      - dbt_utils.expression_is_true:
          expression: email_hash != email_hash_no_salt
      - dbt_utils.expression_is_true:
          expression: email_hash_default_salt = email_hash_default_salt
      - dbt_utils.expression_is_true:
          expression: email_safe_mask = '********'
      - dbt_utils.expression_is_true:
          expression: email_safe_mask_slash = '////////'
      - dbt_utils.expression_is_true:
          expression: email_safe_mask_keep_4 = '********.com'
      - dbt_utils.expression_is_true:
          expression: right(email_safe_mask_keep_left, 8) = '********'
      - dbt_utils.expression_is_true:
          expression: null_safe_mask is null
    columns:
      - name: id
        tests:
          - not_null
          - unique
      - name: name_hash
        tests:
          - not_null
          - unique
      - name: email_hash
        tests:
          - not_null
          - unique
      - name: email_hash_512
        tests:
          - not_null
          - unique
      - name: unique_email_hash
        tests:
          - not_null
          - unique
      - name: email_hash_name_salt
        tests:
          - not_null
          - unique
      - name: email_hash_default_salt
        tests:
          - not_null
          - unique
      - name: email_hash_no_salt
        tests:
          - not_null
          - unique
      - name: email_safe_mask
        tests:
          - uniform
      - name: email_safe_mask_slash
        tests:
          - uniform
      - name: email_safe_mask_keep_4
        tests:
          - uniform
      - name: email_safe_mask_keep_left
        tests:
          - unique
      - name: null_safe_mask
        tests:
          - uniform
